-- Create "users" table
CREATE TABLE "users" ("id" uuid NOT NULL, "created_at" timestamptz NOT NULL, "updated_at" timestamptz NOT NULL, "avatar_url" jsonb NULL, "email" character varying NULL, "name" character varying NOT NULL, "phone" character varying NOT NULL, "address" character varying NULL, "postal_code" character varying NULL, "other_address_info" character varying NULL, PRIMARY KEY ("id"));
-- Create index "users_email_key" to table: "users"
CREATE UNIQUE INDEX "users_email_key" ON "users" ("email");
-- Create index "users_phone_key" to table: "users"
CREATE UNIQUE INDEX "users_phone_key" ON "users" ("phone");
-- Create "accounts" table
CREATE TABLE "accounts" ("id" character varying NOT NULL, "created_at" timestamptz NOT NULL, "updated_at" timestamptz NOT NULL, "last_reset" timestamptz NULL, "last_email_verification" timestamptz NULL, "last_phone_verification" timestamptz NULL, "is_email_verified" boolean NOT NULL DEFAULT false, "is_phone_verified" boolean NOT NULL DEFAULT false, "role" character varying NOT NULL DEFAULT 'CUSTOMER', "password_hash" text NULL, "user_id" uuid NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "accounts_users_user" FOREIGN KEY ("user_id") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
-- Create "conversations" table
CREATE TABLE "conversations" ("id" uuid NOT NULL, "created_at" timestamptz NOT NULL, "updated_at" timestamptz NOT NULL, "title" character varying NULL, "user_one_id" uuid NOT NULL, "user_two_id" uuid NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "conversations_users_user_one" FOREIGN KEY ("user_one_id") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT "conversations_users_user_two" FOREIGN KEY ("user_two_id") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
-- Create index "conversation_user_one_id_user_two_id" to table: "conversations"
CREATE UNIQUE INDEX "conversation_user_one_id_user_two_id" ON "conversations" ("user_one_id", "user_two_id");
-- Create "order_status_codes" table
CREATE TABLE "order_status_codes" ("id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY, "created_at" timestamptz NOT NULL, "updated_at" timestamptz NOT NULL, "order_status" character varying NOT NULL, PRIMARY KEY ("id"));
-- Create index "order_status_codes_order_status_key" to table: "order_status_codes"
CREATE UNIQUE INDEX "order_status_codes_order_status_key" ON "order_status_codes" ("order_status");
-- Create "orders" table
CREATE TABLE "orders" ("id" uuid NOT NULL, "created_at" timestamptz NOT NULL, "updated_at" timestamptz NOT NULL, "note" character varying NULL, "priority" bigint NOT NULL DEFAULT 0, "type" character varying NOT NULL DEFAULT 'SALE', "internal_note" character varying NULL, "customer_id" uuid NOT NULL, "created_by" uuid NOT NULL, "parent_order_id" uuid NULL, "status_code" bigint NOT NULL DEFAULT 1, "management_staff_id" uuid NOT NULL, "warehouse_staff_id" uuid NULL, "delivery_staff_id" uuid NULL, PRIMARY KEY ("id"), CONSTRAINT "orders_order_status_codes_order_status" FOREIGN KEY ("status_code") REFERENCES "order_status_codes" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT "orders_orders_parent_order" FOREIGN KEY ("parent_order_id") REFERENCES "orders" ("id") ON UPDATE NO ACTION ON DELETE SET NULL, CONSTRAINT "orders_users_creator" FOREIGN KEY ("created_by") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT "orders_users_customer" FOREIGN KEY ("customer_id") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT "orders_users_delivery_staff" FOREIGN KEY ("delivery_staff_id") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE SET NULL, CONSTRAINT "orders_users_management_staff" FOREIGN KEY ("management_staff_id") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT "orders_users_warehouse_staff" FOREIGN KEY ("warehouse_staff_id") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE SET NULL);
-- Create index "orders_parent_order_id_key" to table: "orders"
CREATE UNIQUE INDEX "orders_parent_order_id_key" ON "orders" ("parent_order_id");
-- Create "invoices" table
CREATE TABLE "invoices" ("id" uuid NOT NULL, "created_at" timestamptz NOT NULL, "updated_at" timestamptz NOT NULL, "total" numeric(12,2) NOT NULL, "comment" character varying NULL, "note" character varying NULL, "type" character varying NOT NULL DEFAULT 'PRO_FORMA', "status" character varying NOT NULL DEFAULT 'DRAFT', "order_id" uuid NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "invoices_orders_order" FOREIGN KEY ("order_id") REFERENCES "orders" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
-- Create "financial_transactions" table
CREATE TABLE "financial_transactions" ("id" uuid NOT NULL, "created_at" timestamptz NOT NULL, "updated_at" timestamptz NOT NULL, "amount" numeric(12,2) NOT NULL, "comment" character varying NULL, "is_internal" boolean NOT NULL DEFAULT false, "payment_method" character varying NOT NULL DEFAULT 'CASH', "invoice_id" uuid NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "financial_transactions_invoices_invoice" FOREIGN KEY ("invoice_id") REFERENCES "invoices" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
-- Create "products" table
CREATE TABLE "products" ("id" uuid NOT NULL, "created_at" timestamptz NOT NULL, "updated_at" timestamptz NOT NULL, "name" character varying NOT NULL, "description" character varying NULL DEFAULT '', "year" bigint NULL, "price" numeric(12,2) NOT NULL, "qty" numeric(12,2) NOT NULL, "unit_of_measurement" character varying NULL, "type" character varying NULL, "provider" character varying NULL, PRIMARY KEY ("id"));
-- Create "order_line_items" table
CREATE TABLE "order_line_items" ("id" uuid NOT NULL, "created_at" timestamptz NOT NULL, "updated_at" timestamptz NOT NULL, "qty" numeric(12,2) NOT NULL, "order_id" uuid NOT NULL, "product_id" uuid NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "order_line_items_orders_order" FOREIGN KEY ("order_id") REFERENCES "orders" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT "order_line_items_products_product" FOREIGN KEY ("product_id") REFERENCES "products" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
-- Create index "orderlineitem_order_id_product_id" to table: "order_line_items"
CREATE UNIQUE INDEX "orderlineitem_order_id_product_id" ON "order_line_items" ("order_id", "product_id");
-- Create "invoice_line_items" table
CREATE TABLE "invoice_line_items" ("id" uuid NOT NULL, "qty" numeric(12,2) NOT NULL, "total" numeric(12,2) NOT NULL, "created_at" timestamptz NOT NULL, "invoice_id" uuid NOT NULL, "order_line_item_id" uuid NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "invoice_line_items_invoices_invoice" FOREIGN KEY ("invoice_id") REFERENCES "invoices" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT "invoice_line_items_order_line_items_order_line_item" FOREIGN KEY ("order_line_item_id") REFERENCES "order_line_items" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
-- Create index "invoicelineitem_invoice_id_order_line_item_id" to table: "invoice_line_items"
CREATE UNIQUE INDEX "invoicelineitem_invoice_id_order_line_item_id" ON "invoice_line_items" ("invoice_id", "order_line_item_id");
-- Create "messages" table
CREATE TABLE "messages" ("id" uuid NOT NULL, "created_at" timestamptz NOT NULL, "updated_at" timestamptz NOT NULL, "type" character varying NOT NULL DEFAULT 'TEXT', "content" character varying NOT NULL, "is_read" boolean NOT NULL DEFAULT false, "conversation_id" uuid NOT NULL, "sender_id" uuid NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "messages_conversations_conversation" FOREIGN KEY ("conversation_id") REFERENCES "conversations" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT "messages_users_sender" FOREIGN KEY ("sender_id") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
-- Create "product_images" table
CREATE TABLE "product_images" ("id" uuid NOT NULL, "created_at" timestamptz NOT NULL, "updated_at" timestamptz NOT NULL, "image_url" jsonb NOT NULL, "product_id" uuid NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "product_images_products_product" FOREIGN KEY ("product_id") REFERENCES "products" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
-- Create "tags" table
CREATE TABLE "tags" ("id" uuid NOT NULL, "created_at" timestamptz NOT NULL, "updated_at" timestamptz NOT NULL, "title" character varying NOT NULL, PRIMARY KEY ("id"));
-- Create "product_tags" table
CREATE TABLE "product_tags" ("created_at" timestamptz NOT NULL, "product_id" uuid NOT NULL, "tag_id" uuid NOT NULL, PRIMARY KEY ("product_id", "tag_id"), CONSTRAINT "product_tags_products_products" FOREIGN KEY ("product_id") REFERENCES "products" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT "product_tags_tags_tags" FOREIGN KEY ("tag_id") REFERENCES "tags" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
